<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中证A500 [000510.SH]</title>
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #131722;
            color: #d1d4dc;
        }

        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            padding: 12px 20px;
            background: #1e222d;
            border-bottom: 1px solid #2a2e39;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header h1 {
            font-size: 16px;
            font-weight: 500;
            color: #d1d4dc;
        }

        .legend {
            display: flex;
            gap: 15px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 3px;
            border-radius: 1px;
        }

        #chart-container {
            flex: 1;
            width: 100%;
        }

        .ohlc-panel {
            position: absolute;
            top: 50px;
            left: 10px;
            padding: 8px 12px;
            background: rgba(30, 34, 45, 0.85);
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
            pointer-events: none;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .ohlc-item {
            display: flex;
            gap: 4px;
        }

        .ohlc-label {
            color: #787b86;
        }

        .ohlc-value {
            font-weight: 500;
        }

        .ohlc-value.up {
            color: #26a69a;
        }

        .ohlc-value.down {
            color: #ef5350;
        }

        .ohlc-date {
            color: #d1d4dc;
            margin-right: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>中证A500 [000510.SH]</h1>
            <div class="legend" id="legend"></div>
        </div>
        <div id="chart-container">
            <div class="ohlc-panel" id="ohlc-panel"></div>
        </div>
    </div>

    <script>
        // 数据 (由 Python 注入)
        const candlestickData = [{"time": 1704153600, "value": 4030.3787}, {"time": 1704240000, "value": 4018.7277}, {"time": 1704326400, "value": 3979.079}, {"time": 1704412800, "value": 3946.3877}, {"time": 1704672000, "value": 3888.8039}, {"time": 1704844800, "value": 3878.4557}, {"time": 1704931200, "value": 3910.3855}, {"time": 1705017600, "value": 3894.8639}, {"time": 1705276800, "value": 3889.0049}, {"time": 1705363200, "value": 3902.6403}, {"time": 1705449600, "value": 3810.0647}, {"time": 1705536000, "value": 3858.2257}, {"time": 1705622400, "value": 3846.4827}, {"time": 1705881600, "value": 3758.4943}, {"time": 1706054400, "value": 3831.1498}, {"time": 1706486400, "value": 3846.0966}, {"time": 1706572800, "value": 3772.6668}, {"time": 1706659200, "value": 3720.8242}, {"time": 1706745600, "value": 3721.228}, {"time": 1706832000, "value": 3663.7745}, {"time": 1707091200, "value": 3663.4141}, {"time": 1707177600, "value": 3825.4068}, {"time": 1707264000, "value": 3902.1923}, {"time": 1707350400, "value": 3934.2465}, {"time": 1708300800, "value": 3976.7349}, {"time": 1708387200, "value": 3978.074}, {"time": 1708905600, "value": 4034.638}, {"time": 1708992000, "value": 4094.5465}, {"time": 1709078400, "value": 4026.9636}, {"time": 1709164800, "value": 4118.9607}, {"time": 1709251200, "value": 4147.9238}, {"time": 1709510400, "value": 4156.2152}, {"time": 1709596800, "value": 4170.8222}, {"time": 1709683200, "value": 4158.0837}, {"time": 1709769600, "value": 4124.0808}, {"time": 1709856000, "value": 4152.9035}, {"time": 1710115200, "value": 4212.4962}, {"time": 1710201600, "value": 4221.119}, {"time": 1710374400, "value": 4189.2482}, {"time": 1710460800, "value": 4207.0455}, {"time": 1710720000, "value": 4250.2152}, {"time": 1710806400, "value": 4217.7019}, {"time": 1710892800, "value": 4229.9007}, {"time": 1710979200, "value": 4219.376}, {"time": 1711065600, "value": 4176.0562}, {"time": 1711324800, "value": 4142.6672}, {"time": 1711411200, "value": 4157.1085}, {"time": 1711584000, "value": 4127.8593}, {"time": 1711670400, "value": 4154.5404}, {"time": 1712102400, "value": 4200.941}, {"time": 1712534400, "value": 4158.937}, {"time": 1713225600, "value": 4107.536}, {"time": 1713312000, "value": 4185.715}, {"time": 1713398400, "value": 4186.6441}, {"time": 1713484800, "value": 4156.6367}, {"time": 1713744000, "value": 4136.6985}, {"time": 1713830400, "value": 4101.9071}, {"time": 1713916800, "value": 4128.7092}, {"time": 1714003200, "value": 4135.8895}, {"time": 1714089600, "value": 4204.2614}, {"time": 1714435200, "value": 4232.6885}, {"time": 1714953600, "value": 4301.8884}, {"time": 1715040000, "value": 4304.1492}, {"time": 1715126400, "value": 4261.3899}, {"time": 1715212800, "value": 4311.9186}, {"time": 1715299200, "value": 4305.791}, {"time": 1715558400, "value": 4293.7661}, {"time": 1715644800, "value": 4285.7992}, {"time": 1715731200, "value": 4251.0016}, {"time": 1715904000, "value": 4307.9434}, {"time": 1716163200, "value": 4326.8816}, {"time": 1716249600, "value": 4302.3319}, {"time": 1716336000, "value": 4307.3265}, {"time": 1716422400, "value": 4248.8609}, {"time": 1716508800, "value": 4202.585}, {"time": 1716940800, "value": 4218.5961}, {"time": 1717027200, "value": 4197.9554}, {"time": 1717113600, "value": 4182.7067}, {"time": 1717372800, "value": 4189.8555}, {"time": 1717459200, "value": 4228.1035}, {"time": 1717545600, "value": 4199.3654}, {"time": 1717632000, "value": 4189.6447}, {"time": 1717718400, "value": 4167.5318}, {"time": 1718064000, "value": 4140.4942}, {"time": 1718150400, "value": 4145.0701}, {"time": 1718236800, "value": 4120.6333}, {"time": 1718582400, "value": 4132.5265}, {"time": 1718668800, "value": 4146.0002}, {"time": 1718755200, "value": 4120.3925}, {"time": 1718841600, "value": 4080.5666}, {"time": 1718928000, "value": 4074.6825}, {"time": 1719187200, "value": 4040.092}, {"time": 1719532800, "value": 4023.3329}, {"time": 1719792000, "value": 4046.4624}, {"time": 1719878400, "value": 4029.6743}, {"time": 1720051200, "value": 3991.1937}, {"time": 1720483200, "value": 3997.3999}, {"time": 1720569600, "value": 3985.7207}, {"time": 1720656000, "value": 4043.5772}, {"time": 1721088000, "value": 4064.5602}, {"time": 1721606400, "value": 4073.0129}, {"time": 1721692800, "value": 3975.6611}, {"time": 1721779200, "value": 3946.0506}, {"time": 1721865600, "value": 3925.345}, {"time": 1721952000, "value": 3948.5897}, {"time": 1722211200, "value": 3924.4203}, {"time": 1722297600, "value": 3901.8144}, {"time": 1722384000, "value": 3997.4729}, {"time": 1722470400, "value": 3970.3503}, {"time": 1722556800, "value": 3926.4671}, {"time": 1722816000, "value": 3869.2557}, {"time": 1722902400, "value": 3879.5731}, {"time": 1722988800, "value": 3877.8217}, {"time": 1723075200, "value": 3876.5315}, {"time": 1723161600, "value": 3861.3742}, {"time": 1723680000, "value": 3866.7792}, {"time": 1723766400, "value": 3867.0052}, {"time": 1724025600, "value": 3878.3454}, {"time": 1724112000, "value": 3844.6932}, {"time": 1724198400, "value": 3834.7516}, {"time": 1724371200, "value": 3833.1891}, {"time": 1724630400, "value": 3832.6981}, {"time": 1724716800, "value": 3807.5371}, {"time": 1724889600, "value": 3795.7837}, {"time": 1724976000, "value": 3851.8711}, {"time": 1725235200, "value": 3780.4448}, {"time": 1725321600, "value": 3800.6625}, {"time": 1725580800, "value": 3747.9593}, {"time": 1725840000, "value": 3706.3787}, {"time": 1726012800, "value": 3709.1969}, {"time": 1726099200, "value": 3691.6245}, {"time": 1726185600, "value": 3671.0578}, {"time": 1726617600, "value": 3685.0201}, {"time": 1726790400, "value": 3717.1664}, {"time": 1727049600, "value": 3725.7811}, {"time": 1727136000, "value": 3885.1727}, {"time": 1727308800, "value": 4103.8233}, {"time": 1727395200, "value": 4298.5618}, {"time": 1727654400, "value": 4684.8913}, {"time": 1728345600, "value": 4981.2967}, {"time": 1728432000, "value": 4630.9391}, {"time": 1728518400, "value": 4661.0297}, {"time": 1728604800, "value": 4516.4741}, {"time": 1728864000, "value": 4609.5528}, {"time": 1728950400, "value": 4495.5654}, {"time": 1729209600, "value": 4581.324}, {"time": 1729555200, "value": 4644.9181}, {"time": 1729641600, "value": 4664.2537}, {"time": 1729728000, "value": 4610.7357}, {"time": 1730073600, "value": 4674.8209}, {"time": 1730160000, "value": 4628.6081}, {"time": 1730246400, "value": 4603.9797}, {"time": 1730332800, "value": 4614.7899}, {"time": 1730419200, "value": 4597.4523}, {"time": 1730678400, "value": 4665.2022}, {"time": 1730764800, "value": 4789.7621}, {"time": 1730937600, "value": 4893.3061}, {"time": 1731024000, "value": 4860.8838}, {"time": 1731283200, "value": 4913.9314}, {"time": 1731369600, "value": 4862.3855}, {"time": 1731456000, "value": 4883.9804}, {"time": 1731542400, "value": 4779.6745}, {"time": 1731628800, "value": 4687.8861}, {"time": 1731888000, "value": 4648.174}, {"time": 1731974400, "value": 4692.8806}, {"time": 1732147200, "value": 4716.7551}, {"time": 1732233600, "value": 4566.5518}, {"time": 1732665600, "value": 4608.3779}, {"time": 1732752000, "value": 4565.127}, {"time": 1732838400, "value": 4620.2722}, {"time": 1733097600, "value": 4669.0692}, {"time": 1733184000, "value": 4666.9088}, {"time": 1733270400, "value": 4635.8751}, {"time": 1733356800, "value": 4631.0322}, {"time": 1733702400, "value": 4682.5165}, {"time": 1733788800, "value": 4715.9391}, {"time": 1733875200, "value": 4717.1779}, {"time": 1733961600, "value": 4759.4119}, {"time": 1734048000, "value": 4649.9465}, {"time": 1734307200, "value": 4617.1709}, {"time": 1734393600, "value": 4616.9456}, {"time": 1734566400, "value": 4653.5084}, {"time": 1734652800, "value": 4639.2146}, {"time": 1734912000, "value": 4626.1369}, {"time": 1734998400, "value": 4682.2223}, {"time": 1735171200, "value": 4684.843}, {"time": 1735516800, "value": 4693.2317}, {"time": 1735603200, "value": 4608.9405}, {"time": 1735776000, "value": 4473.6597}, {"time": 1735862400, "value": 4411.0352}, {"time": 1736121600, "value": 4402.911}, {"time": 1736380800, "value": 4424.244}, {"time": 1736467200, "value": 4365.5396}, {"time": 1736726400, "value": 4358.1951}, {"time": 1736899200, "value": 4452.022}, {"time": 1737072000, "value": 4476.9817}, {"time": 1737331200, "value": 4499.5431}, {"time": 1737417600, "value": 4507.0593}, {"time": 1737504000, "value": 4466.6551}, {"time": 1737590400, "value": 4463.9674}, {"time": 1737676800, "value": 4504.0095}, {"time": 1737936000, "value": 4478.6606}, {"time": 1738713600, "value": 4468.2444}, {"time": 1738800000, "value": 4540.9167}, {"time": 1739232000, "value": 4603.1353}, {"time": 1739318400, "value": 4652.6661}, {"time": 1739491200, "value": 4675.9742}, {"time": 1739750400, "value": 4681.5176}, {"time": 1739923200, "value": 4674.2825}, {"time": 1740009600, "value": 4667.8786}, {"time": 1740096000, "value": 4734.8618}, {"time": 1740355200, "value": 4725.3504}, {"time": 1740528000, "value": 4712.6208}, {"time": 1740614400, "value": 4712.3286}, {"time": 1740700800, "value": 4606.3568}, {"time": 1740960000, "value": 4611.5773}, {"time": 1741046400, "value": 4613.7987}, {"time": 1741132800, "value": 4632.2461}, {"time": 1741219200, "value": 4704.5761}, {"time": 1741305600, "value": 4690.5557}, {"time": 1741564800, "value": 4677.5246}, {"time": 1741651200, "value": 4692.0389}, {"time": 1741737600, "value": 4676.3047}, {"time": 1741824000, "value": 4648.5293}, {"time": 1741910400, "value": 4755.1501}, {"time": 1742169600, "value": 4748.0978}, {"time": 1742256000, "value": 4765.5534}, {"time": 1742342400, "value": 4758.8903}, {"time": 1742428800, "value": 4718.1824}, {"time": 1742515200, "value": 4642.7435}, {"time": 1742774400, "value": 4661.7548}, {"time": 1742860800, "value": 4653.2483}, {"time": 1743120000, "value": 4627.1403}, {"time": 1743552000, "value": 4590.6699}, {"time": 1743638400, "value": 4554.2481}, {"time": 1744156800, "value": 4311.8391}, {"time": 1744243200, "value": 4376.2774}, {"time": 1744329600, "value": 4400.6428}, {"time": 1744588800, "value": 4417.5218}, {"time": 1744761600, "value": 4415.3764}, {"time": 1744934400, "value": 4413.1407}, {"time": 1745193600, "value": 4444.332}, {"time": 1745280000, "value": 4436.5102}, {"time": 1745366400, "value": 4444.9653}, {"time": 1745539200, "value": 4443.1746}, {"time": 1745798400, "value": 4432.1385}, {"time": 1745884800, "value": 4431.6336}, {"time": 1745971200, "value": 4435.81}, {"time": 1746489600, "value": 4494.626}, {"time": 1746576000, "value": 4517.504}, {"time": 1746748800, "value": 4526.2419}, {"time": 1747008000, "value": 4583.1916}, {"time": 1747180800, "value": 4626.0749}, {"time": 1747267200, "value": 4578.1774}, {"time": 1747353600, "value": 4563.0199}, {"time": 1747612800, "value": 4552.4145}, {"time": 1747699200, "value": 4579.383}, {"time": 1747872000, "value": 4585.8343}, {"time": 1747958400, "value": 4549.8879}, {"time": 1748217600, "value": 4531.7345}, {"time": 1748908800, "value": 4512.0749}, {"time": 1748995200, "value": 4533.8339}, {"time": 1749081600, "value": 4549.5389}, {"time": 1749168000, "value": 4545.0977}, {"time": 1749427200, "value": 4562.7654}, {"time": 1749513600, "value": 4536.0459}, {"time": 1749686400, "value": 4566.6038}, {"time": 1750118400, "value": 4537.1822}, {"time": 1750204800, "value": 4540.4119}, {"time": 1750291200, "value": 4499.8166}, {"time": 1750636800, "value": 4509.8859}, {"time": 1750723200, "value": 4570.1885}, {"time": 1750809600, "value": 4631.2658}, {"time": 1750982400, "value": 4601.7672}, {"time": 1751241600, "value": 4630.4534}, {"time": 1751414400, "value": 4627.6555}, {"time": 1751500800, "value": 4656.9063}, {"time": 1751587200, "value": 4662.5144}, {"time": 1751846400, "value": 4639.96}, {"time": 1751932800, "value": 4687.5758}, {"time": 1752019200, "value": 4676.0508}, {"time": 1752105600, "value": 4696.4381}, {"time": 1752451200, "value": 4709.7777}, {"time": 1752624000, "value": 4707.3519}, {"time": 1752710400, "value": 4749.7362}, {"time": 1752796800, "value": 4773.2394}, {"time": 1753056000, "value": 4808.6219}, {"time": 1753142400, "value": 4849.167}, {"time": 1753228800, "value": 4844.3264}, {"time": 1753315200, "value": 4888.719}, {"time": 1753401600, "value": 4871.116}, {"time": 1753660800, "value": 4885.7748}, {"time": 1753747200, "value": 4910.1899}, {"time": 1753833600, "value": 4899.1984}, {"time": 1753920000, "value": 4813.3899}, {"time": 1754265600, "value": 4814.0672}, {"time": 1754352000, "value": 4846.5077}, {"time": 1754611200, "value": 4852.4132}, {"time": 1754870400, "value": 4886.8439}, {"time": 1754956800, "value": 4907.7999}, {"time": 1755043200, "value": 4956.0257}, {"time": 1755216000, "value": 4985.8298}, {"time": 1755561600, "value": 5016.8246}, {"time": 1755648000, "value": 5075.2184}, {"time": 1755734400, "value": 5089.3353}, {"time": 1755820800, "value": 5198.9127}, {"time": 1756252800, "value": 5227.9827}, {"time": 1756339200, "value": 5327.8815}, {"time": 1756425600, "value": 5372.764}, {"time": 1756771200, "value": 5358.4445}, {"time": 1756857600, "value": 5323.4913}, {"time": 1756944000, "value": 5192.0176}, {"time": 1757030400, "value": 5333.0747}, {"time": 1757376000, "value": 5314.409}, {"time": 1757462400, "value": 5325.8086}, {"time": 1757548800, "value": 5454.2736}, {"time": 1757635200, "value": 5432.2147}, {"time": 1757894400, "value": 5448.412}, {"time": 1757980800, "value": 5449.9773}, {"time": 1758153600, "value": 5433.7597}, {"time": 1758240000, "value": 5433.289}, {"time": 1758585600, "value": 5446.018}, {"time": 1758672000, "value": 5521.8186}, {"time": 1758758400, "value": 5561.1343}, {"time": 1759104000, "value": 5579.0262}, {"time": 1759190400, "value": 5618.713}, {"time": 1759968000, "value": 5708.2876}, {"time": 1760054400, "value": 5577.653}, {"time": 1760313600, "value": 5550.2962}, {"time": 1760572800, "value": 5531.7861}, {"time": 1761177600, "value": 5510.4633}, {"time": 1761264000, "value": 5586.3547}, {"time": 1761609600, "value": 5628.2923}, {"time": 1761696000, "value": 5703.9885}, {"time": 1761782400, "value": 5653.7481}, {"time": 1761868800, "value": 5583.7242}, {"time": 1762214400, "value": 5535.3659}, {"time": 1762300800, "value": 5548.0698}, {"time": 1762387200, "value": 5633.5172}, {"time": 1762819200, "value": 5588.2301}, {"time": 1762905600, "value": 5574.5059}, {"time": 1762992000, "value": 5654.4394}, {"time": 1763078400, "value": 5563.5019}, {"time": 1763337600, "value": 5540.1082}, {"time": 1763596800, "value": 5475.5503}, {"time": 1763683200, "value": 5325.9875}, {"time": 1763942400, "value": 5334.3149}, {"time": 1764028800, "value": 5392.9109}, {"time": 1764115200, "value": 5422.5212}, {"time": 1764201600, "value": 5415.9267}, {"time": 1764288000, "value": 5440.9431}, {"time": 1764633600, "value": 5471.1852}, {"time": 1764720000, "value": 5440.6233}, {"time": 1764806400, "value": 5461.7504}, {"time": 1764892800, "value": 5513.753}, {"time": 1765152000, "value": 5561.3663}, {"time": 1765238400, "value": 5530.0336}, {"time": 1765324800, "value": 5532.5903}, {"time": 1765411200, "value": 5486.3075}, {"time": 1765497600, "value": 5530.3907}, {"time": 1765756800, "value": 5490.1205}, {"time": 1765843200, "value": 5414.9348}, {"time": 1766016000, "value": 5486.2618}, {"time": 1766102400, "value": 5516.1706}, {"time": 1766361600, "value": 5580.2783}, {"time": 1766448000, "value": 5592.4337}, {"time": 1766534400, "value": 5622.5153}, {"time": 1766620800, "value": 5636.7388}, {"time": 1766707200, "value": 5667.8201}, {"time": 1766966400, "value": 5640.7597}];
        const indicators = [{"name": "EMA20", "data": [{"time": 1704153600, "value": 4030.3787}, {"time": 1704240000, "value": 4029.269080952381}, {"time": 1704326400, "value": 4024.4890732426306}, {"time": 1704412800, "value": 4017.050847219523}, {"time": 1704672000, "value": 4004.836852246235}, {"time": 1704844800, "value": 3992.800552032308}, {"time": 1704931200, "value": 3984.9514994578026}, {"time": 1705017600, "value": 3976.371728080869}, {"time": 1705276800, "value": 3968.0510777874533}, {"time": 1705363200, "value": 3961.821479902934}, {"time": 1705449600, "value": 3947.3684532455113}, {"time": 1705536000, "value": 3938.8786672221295}, {"time": 1705622400, "value": 3930.0790512962126}, {"time": 1705881600, "value": 3913.7376464108593}, {"time": 1706054400, "value": 3905.872137228873}, {"time": 1706486400, "value": 3900.179228921361}, {"time": 1706572800, "value": 3888.035188071707}, {"time": 1706659200, "value": 3872.110332064878}, {"time": 1706745600, "value": 3857.7405861539373}, {"time": 1706832000, "value": 3839.2676255678484}, {"time": 1707091200, "value": 3822.519670751863}, {"time": 1707177600, "value": 3822.794635442162}, {"time": 1707264000, "value": 3830.3563177810033}, {"time": 1707350400, "value": 3840.250620849479}, {"time": 1708300800, "value": 3853.249123625719}, {"time": 1708387200, "value": 3865.137207089936}, {"time": 1708905600, "value": 3881.2801397480375}, {"time": 1708992000, "value": 3901.591221676796}, {"time": 1709078400, "value": 3913.5314481837677}, {"time": 1709164800, "value": 3933.096138832933}, {"time": 1709251200, "value": 3953.5559160869393}, {"time": 1709510400, "value": 3972.8568002691354}, {"time": 1709596800, "value": 3991.710647862551}, {"time": 1709683200, "value": 4007.55570044707}, {"time": 1709769600, "value": 4018.653328975921}, {"time": 1709856000, "value": 4031.4390595496425}, {"time": 1710115200, "value": 4048.6825967353907}, {"time": 1710201600, "value": 4065.10511133202}, {"time": 1710374400, "value": 4076.928262633732}, {"time": 1710460800, "value": 4089.3203804781383}, {"time": 1710720000, "value": 4104.643696623078}, {"time": 1710806400, "value": 4115.411144563736}, {"time": 1710892800, "value": 4126.314911748143}, {"time": 1710979200, "value": 4135.177872534034}, {"time": 1711065600, "value": 4139.071046578411}, {"time": 1711324800, "value": 4139.4135373804675}, {"time": 1711411200, "value": 4141.098771915661}, {"time": 1711584000, "value": 4139.837869828455}, {"time": 1711670400, "value": 4141.238110797173}, {"time": 1712102400, "value": 4146.924100245062}, {"time": 1712534400, "value": 4148.068185936008}, {"time": 1713225600, "value": 4144.2079777516265}, {"time": 1713312000, "value": 4148.161027489567}, {"time": 1713398400, "value": 4151.82608201437}, {"time": 1713484800, "value": 4152.284236108239}, {"time": 1713744000, "value": 4150.799880288407}, {"time": 1713830400, "value": 4146.143425022844}, {"time": 1713916800, "value": 4144.483022639716}, {"time": 1714003200, "value": 4143.664591912125}, {"time": 1714089600, "value": 4149.435716491923}, {"time": 1714435200, "value": 4157.364553016501}, {"time": 1714953600, "value": 4171.128728919692}, {"time": 1715040000, "value": 4183.7973452130545}, {"time": 1715126400, "value": 4191.187112335621}, {"time": 1715212800, "value": 4202.6853492560385}, {"time": 1715299200, "value": 4212.504935041178}, {"time": 1715558400, "value": 4220.244093608685}, {"time": 1715644800, "value": 4226.487437074525}, {"time": 1715731200, "value": 4228.822119257903}, {"time": 1715904000, "value": 4236.357479328579}, {"time": 1716163200, "value": 4244.978824154428}, {"time": 1716249600, "value": 4250.441021854006}, {"time": 1716336000, "value": 4255.858686439339}, {"time": 1716422400, "value": 4255.192230587973}, {"time": 1716508800, "value": 4250.182018151024}, {"time": 1716940800, "value": 4247.173835469974}, {"time": 1717027200, "value": 4242.486365425214}, {"time": 1717113600, "value": 4236.7930639561455}, {"time": 1717372800, "value": 4232.322819769846}, {"time": 1717459200, "value": 4231.920979791766}, {"time": 1717545600, "value": 4228.820448383026}, {"time": 1717632000, "value": 4225.0894247275}, {"time": 1717718400, "value": 4219.607746182024}, {"time": 1718064000, "value": 4212.0731227361175}, {"time": 1718150400, "value": 4205.691882475535}, {"time": 1718236800, "value": 4197.591065096913}, {"time": 1718582400, "value": 4191.394439849588}, {"time": 1718668800, "value": 4187.071178911532}, {"time": 1718755200, "value": 4180.720828539005}, {"time": 1718841600, "value": 4171.182330582909}, {"time": 1718928000, "value": 4161.991870527394}, {"time": 1719187200, "value": 4150.3823590485945}, {"time": 1719532800, "value": 4138.2824105677755}, {"time": 1719792000, "value": 4129.537647656559}, {"time": 1719878400, "value": 4120.0268526416485}, {"time": 1720051200, "value": 4107.75702858054}, {"time": 1720483200, "value": 4097.246825858583}, {"time": 1720569600, "value": 4086.6252900625277}, {"time": 1720656000, "value": 4082.5254719613345}, {"time": 1721088000, "value": 4080.814493679303}, {"time": 1721606400, "value": 4080.0714847574645}, {"time": 1721692800, "value": 4070.1276385900874}, {"time": 1721779200, "value": 4058.310777771984}, {"time": 1721865600, "value": 4045.647370365128}, {"time": 1721952000, "value": 4036.403782711306}, {"time": 1722211200, "value": 4025.7386891197534}, {"time": 1722297600, "value": 4013.936375870253}, {"time": 1722384000, "value": 4012.368425787372}, {"time": 1722470400, "value": 4008.366699521908}, {"time": 1722556800, "value": 4000.5667376626784}, {"time": 1722816000, "value": 3988.060924551947}, {"time": 1722902400, "value": 3977.728750785095}, {"time": 1722988800, "value": 3968.2137935674673}, {"time": 1723075200, "value": 3959.482146561042}, {"time": 1723161600, "value": 3950.1385326028476}, {"time": 1723680000, "value": 3942.1995485454336}, {"time": 1723766400, "value": 3935.0381820172975}, {"time": 1724025600, "value": 3929.6388694442217}, {"time": 1724112000, "value": 3921.5488056876293}, {"time": 1724198400, "value": 3913.28240514595}, {"time": 1724371200, "value": 3905.654471322526}, {"time": 1724630400, "value": 3898.706245482286}, {"time": 1724716800, "value": 3890.023469722068}, {"time": 1724889600, "value": 3881.0482535580613}, {"time": 1724976000, "value": 3878.269477028722}, {"time": 1725235200, "value": 3868.952841121225}, {"time": 1725321600, "value": 3862.44899910968}, {"time": 1725580800, "value": 3851.545218242091}, {"time": 1725840000, "value": 3837.7198355523683}, {"time": 1726012800, "value": 3825.4795559759523}, {"time": 1726099200, "value": 3812.7314554068143}, {"time": 1726185600, "value": 3799.2387263204514}, {"time": 1726617600, "value": 3788.36076190898}, {"time": 1726790400, "value": 3781.580346489077}, {"time": 1727049600, "value": 3776.266132537736}, {"time": 1727136000, "value": 3786.638186581761}, {"time": 1727308800, "value": 3816.8462926215934}, {"time": 1727395200, "value": 3862.7239599909653}, {"time": 1727654400, "value": 3941.0256114203976}, {"time": 1728345600, "value": 4040.0990484279787}, {"time": 1728432000, "value": 4096.369529530076}, {"time": 1728518400, "value": 4150.14668862245}, {"time": 1728604800, "value": 4185.0350135155495}, {"time": 1728864000, "value": 4225.465278895021}, {"time": 1728950400, "value": 4251.189099952638}, {"time": 1729209600, "value": 4282.630519004767}, {"time": 1729555200, "value": 4317.13409814717}, {"time": 1729641600, "value": 4350.19310784744}, {"time": 1729728000, "value": 4375.0066880524455}, {"time": 1730073600, "value": 4403.560422523641}, {"time": 1730160000, "value": 4424.993534664247}, {"time": 1730246400, "value": 4442.039836124794}, {"time": 1730332800, "value": 4458.492223160529}, {"time": 1730419200, "value": 4471.726516192859}, {"time": 1730678400, "value": 4490.152771793539}, {"time": 1730764800, "value": 4518.686993527487}, {"time": 1730937600, "value": 4554.365003667726}, {"time": 1731024000, "value": 4583.557269985085}, {"time": 1731283200, "value": 4615.021472843649}, {"time": 1731369600, "value": 4638.579951620444}, {"time": 1731456000, "value": 4661.951422894687}, {"time": 1731542400, "value": 4673.163144523765}, {"time": 1731628800, "value": 4674.565330759598}, {"time": 1731888000, "value": 4672.051870687255}, {"time": 1731974400, "value": 4674.035559193231}, {"time": 1732147200, "value": 4678.104086889113}, {"time": 1732233600, "value": 4667.48005956634}, {"time": 1732665600, "value": 4661.851282464783}, {"time": 1732752000, "value": 4652.639446039566}, {"time": 1732838400, "value": 4649.556851178655}, {"time": 1733097600, "value": 4651.415170114022}, {"time": 1733184000, "value": 4652.890753912687}, {"time": 1733270400, "value": 4651.2702154448125}, {"time": 1733356800, "value": 4649.342785402449}, {"time": 1733702400, "value": 4652.502186792693}, {"time": 1733788800, "value": 4658.543797574341}, {"time": 1733875200, "value": 4664.127997805356}, {"time": 1733961600, "value": 4673.202655157227}, {"time": 1734048000, "value": 4670.987783237491}, {"time": 1734307200, "value": 4665.862365786302}, {"time": 1734393600, "value": 4661.2036261876065}, {"time": 1734566400, "value": 4660.470747503073}, {"time": 1734652800, "value": 4658.44635250278}, {"time": 1734912000, "value": 4655.36926178823}, {"time": 1734998400, "value": 4657.926693998874}, {"time": 1735171200, "value": 4660.490151713267}, {"time": 1735516800, "value": 4663.608394407242}, {"time": 1735603200, "value": 4658.401928273218}, {"time": 1735776000, "value": 4640.807430342435}, {"time": 1735862400, "value": 4618.924360786012}, {"time": 1736121600, "value": 4598.351659758773}, {"time": 1736380800, "value": 4581.769977876986}, {"time": 1736467200, "value": 4561.176608555368}, {"time": 1736726400, "value": 4541.845036312}, {"time": 1736899200, "value": 4533.290461425143}, {"time": 1737072000, "value": 4527.927722241796}, {"time": 1737331200, "value": 4525.224424885435}, {"time": 1737417600, "value": 4523.494412991584}, {"time": 1737504000, "value": 4518.081145087624}, {"time": 1737590400, "value": 4512.927455079279}, {"time": 1737676800, "value": 4512.078126024109}, {"time": 1737936000, "value": 4508.895504498004}, {"time": 1738713600, "value": 4505.023970736289}, {"time": 1738800000, "value": 4508.442325904261}, {"time": 1739232000, "value": 4517.460704389569}, {"time": 1739318400, "value": 4530.33740873342}, {"time": 1739491200, "value": 4544.207579330237}, {"time": 1739750400, "value": 4557.284724155929}, {"time": 1739923200, "value": 4568.427369474412}, {"time": 1740009600, "value": 4577.898915238754}, {"time": 1740096000, "value": 4592.847761406492}, {"time": 1740355200, "value": 4605.46706032016}, {"time": 1740528000, "value": 4615.672178384907}, {"time": 1740614400, "value": 4624.877551872059}, {"time": 1740700800, "value": 4623.113670741386}, {"time": 1740960000, "value": 4622.014968766016}, {"time": 1741046400, "value": 4621.232466978776}, {"time": 1741132800, "value": 4622.281384409369}, {"time": 1741219200, "value": 4630.1189763703815}, {"time": 1741305600, "value": 4635.874854811297}, {"time": 1741564800, "value": 4639.841497210221}, {"time": 1741651200, "value": 4644.812678428295}, {"time": 1741737600, "value": 4647.811918577981}, {"time": 1741824000, "value": 4647.880240618173}, {"time": 1741910400, "value": 4658.096417702156}, {"time": 1742169600, "value": 4666.667977920998}, {"time": 1742256000, "value": 4676.085637166617}, {"time": 1742342400, "value": 4683.971795531701}, {"time": 1742428800, "value": 4687.229948338206}, {"time": 1742515200, "value": 4682.993143734567}, {"time": 1742774400, "value": 4680.970444331275}, {"time": 1742860800, "value": 4678.330240109249}, {"time": 1743120000, "value": 4673.455007717892}, {"time": 1743552000, "value": 4665.570711744759}, {"time": 1743638400, "value": 4654.9685582452585}, {"time": 1744156800, "value": 4622.2895622219}, {"time": 1744243200, "value": 4598.8598324864815}, {"time": 1744329600, "value": 4579.982019868721}, {"time": 1744588800, "value": 4564.509617976462}, {"time": 1744761600, "value": 4550.3064543596565}, {"time": 1744934400, "value": 4537.243049182546}, {"time": 1745193600, "value": 4528.394377831827}, {"time": 1745280000, "value": 4519.643503752605}, {"time": 1745366400, "value": 4512.531293871405}, {"time": 1745539200, "value": 4505.925894455081}, {"time": 1745798400, "value": 4498.898523554597}, {"time": 1745884800, "value": 4492.492340358921}, {"time": 1745971200, "value": 4487.0940222295}, {"time": 1746489600, "value": 4487.811353445739}, {"time": 1746576000, "value": 4490.639224546145}, {"time": 1746748800, "value": 4494.02995554175}, {"time": 1747008000, "value": 4502.521540728249}, {"time": 1747180800, "value": 4514.288527325559}, {"time": 1747267200, "value": 4520.373181865982}, {"time": 1747353600, "value": 4524.434774069222}, {"time": 1747612800, "value": 4527.099509872153}, {"time": 1747699200, "value": 4532.078889884329}, {"time": 1747872000, "value": 4537.198452752488}, {"time": 1747958400, "value": 4538.406971537966}, {"time": 1748217600, "value": 4537.7714980581595}, {"time": 1748908800, "value": 4535.324203005001}, {"time": 1748995200, "value": 4535.182269385477}, {"time": 1749081600, "value": 4536.549567539241}, {"time": 1749168000, "value": 4537.363675392648}, {"time": 1749427200, "value": 4539.782887260015}, {"time": 1749513600, "value": 4539.426983711442}, {"time": 1749686400, "value": 4542.015251929399}, {"time": 1750118400, "value": 4541.554961269456}, {"time": 1750204800, "value": 4541.446098291412}, {"time": 1750291200, "value": 4537.481384168421}, {"time": 1750636800, "value": 4534.853242819047}, {"time": 1750723200, "value": 4538.218505407709}, {"time": 1750809600, "value": 4547.080152511737}, {"time": 1750982400, "value": 4552.288442748714}, {"time": 1751241600, "value": 4559.732724391694}, {"time": 1751414400, "value": 4566.201560163914}, {"time": 1751500800, "value": 4574.84010681497}, {"time": 1751587200, "value": 4583.190039499259}, {"time": 1751846400, "value": 4588.596702404092}, {"time": 1751932800, "value": 4598.023283127512}, {"time": 1752019200, "value": 4605.454475210606}, {"time": 1752105600, "value": 4614.119582333405}, {"time": 1752451200, "value": 4623.229879254032}, {"time": 1752624000, "value": 4631.241500277458}, {"time": 1752710400, "value": 4642.526709774843}, {"time": 1752796800, "value": 4654.975537415334}, {"time": 1753056000, "value": 4669.60852432816}, {"time": 1753142400, "value": 4686.709331535001}, {"time": 1753228800, "value": 4701.72048091262}, {"time": 1753315200, "value": 4719.529863682847}, {"time": 1753401600, "value": 4733.966638570195}, {"time": 1753660800, "value": 4748.424558706366}, {"time": 1753747200, "value": 4763.830781686713}, {"time": 1753833600, "value": 4776.7229358117875}, {"time": 1753920000, "value": 4780.215027639236}, {"time": 1754265600, "value": 4783.439044054547}, {"time": 1754352000, "value": 4789.445582716018}, {"time": 1754611200, "value": 4795.442498647826}, {"time": 1754870400, "value": 4804.147394014701}, {"time": 1754956800, "value": 4814.019061251396}, {"time": 1755043200, "value": 4827.543503036977}, {"time": 1755216000, "value": 4842.618388462027}, {"time": 1755561600, "value": 4859.209456227548}, {"time": 1755648000, "value": 4879.781736586829}, {"time": 1755734400, "value": 4899.739218816654}, {"time": 1755820800, "value": 4928.231931310306}, {"time": 1756252800, "value": 4956.779623566467}, {"time": 1756339200, "value": 4992.12265941728}, {"time": 1756425600, "value": 5028.374215663254}, {"time": 1756771200, "value": 5059.809480838182}, {"time": 1756857600, "value": 5084.92203504407}, {"time": 1756944000, "value": 5095.121612658921}, {"time": 1757030400, "value": 5117.78381145331}, {"time": 1757376000, "value": 5136.510019886327}, {"time": 1757462400, "value": 5154.538456087629}, {"time": 1757548800, "value": 5183.08466026976}, {"time": 1757635200, "value": 5206.811330720258}, {"time": 1757894400, "value": 5229.8209182707105}, {"time": 1757980800, "value": 5250.788192721119}, {"time": 1758153600, "value": 5268.214050557203}, {"time": 1758240000, "value": 5283.93547431366}, {"time": 1758585600, "value": 5299.371905331407}, {"time": 1758672000, "value": 5320.557304823654}, {"time": 1758758400, "value": 5343.469399602353}, {"time": 1759104000, "value": 5365.903380592606}, {"time": 1759190400, "value": 5389.9804872028335}, {"time": 1759968000, "value": 5420.295450326374}, {"time": 1760054400, "value": 5435.281883628624}, {"time": 1760313600, "value": 5446.235628044946}, {"time": 1760572800, "value": 5454.383292040665}, {"time": 1761177600, "value": 5459.724245179649}, {"time": 1761264000, "value": 5471.784288495873}, {"time": 1761609600, "value": 5486.689813401027}, {"time": 1761696000, "value": 5507.384926410453}, {"time": 1761782400, "value": 5521.324276276124}, {"time": 1761868800, "value": 5527.267126154588}, {"time": 1762214400, "value": 5528.038437949389}, {"time": 1762300800, "value": 5529.9461867161135}, {"time": 1762387200, "value": 5539.810092743151}, {"time": 1762819200, "value": 5544.421522005708}, {"time": 1762905600, "value": 5547.286700862307}, {"time": 1762992000, "value": 5557.491719827802}, {"time": 1763078400, "value": 5558.06411793944}, {"time": 1763337600, "value": 5556.354030516636}, {"time": 1763596800, "value": 5548.6584371341}, {"time": 1763683200, "value": 5527.451681216567}, {"time": 1763942400, "value": 5509.0577020530845}, {"time": 1764028800, "value": 5497.996101857553}, {"time": 1764115200, "value": 5490.808015966358}, {"time": 1764201600, "value": 5483.6764620648}, {"time": 1764288000, "value": 5479.6066180586295}, {"time": 1764633600, "value": 5478.804578243522}, {"time": 1764720000, "value": 5475.168266029853}, {"time": 1764806400, "value": 5473.89037402701}, {"time": 1764892800, "value": 5477.686814595866}, {"time": 1765152000, "value": 5485.656289396259}, {"time": 1765238400, "value": 5489.882699929949}, {"time": 1765324800, "value": 5493.950090412811}, {"time": 1765411200, "value": 5493.22222465921}, {"time": 1765497600, "value": 5496.762079453571}, {"time": 1765756800, "value": 5496.12954807704}, {"time": 1765843200, "value": 5488.3967149268465}, {"time": 1766016000, "value": 5488.193389695718}, {"time": 1766102400, "value": 5490.857885915174}, {"time": 1766361600, "value": 5499.374115828014}, {"time": 1766448000, "value": 5508.236933368203}, {"time": 1766534400, "value": 5519.1205873331355}, {"time": 1766620800, "value": 5530.322321872836}, {"time": 1766707200, "value": 5543.417348361138}, {"time": 1766966400, "value": 5552.68804851722}], "color": "#FFA500", "lineWidth": 2}];
        const strokesData = [];
        const markersData = [];
        const pricePrecision = 4;


        // 创建图表
        const container = document.getElementById('chart-container');
        const chart = LightweightCharts.createChart(container, {
            layout: {
                background: { type: 'solid', color: '#131722' },
                textColor: '#d1d4dc',
            },
            grid: {
                vertLines: { color: '#1e222d' },
                horzLines: { color: '#1e222d' },
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
                vertLine: {
                    color: '#758696',
                    width: 1,
                    style: LightweightCharts.LineStyle.Dashed,
                    labelBackgroundColor: '#2a2e39',
                },
                horzLine: {
                    color: '#758696',
                    width: 1,
                    style: LightweightCharts.LineStyle.Dashed,
                    labelBackgroundColor: '#2a2e39',
                },
            },
            rightPriceScale: {
                borderColor: '#2a2e39',
                mode: LightweightCharts.PriceScaleMode.Logarithmic,
                scaleMargins: {
                    top: 0.1,
                    bottom: 0.1,
                },
            },
            timeScale: {
                borderColor: '#2a2e39',
                timeVisible: false,
                secondsVisible: false,
                rightOffset: 5,
                tickMarkFormatter: (time) => {
                    const date = new Date(time * 1000);
                    const yy = String(date.getFullYear()).slice(-2);
                    const mm = String(date.getMonth() + 1).padStart(2, '0');
                    const dd = String(date.getDate()).padStart(2, '0');
                    return `${yy}-${mm}-${dd}`;
                },
            },
            localization: {
                timeFormatter: (time) => {
                    const date = new Date(time * 1000);
                    const yy = String(date.getFullYear()).slice(-2);
                    const mm = String(date.getMonth() + 1).padStart(2, '0');
                    const dd = String(date.getDate()).padStart(2, '0');
                    return `${yy}-${mm}-${dd}`;
                },
            },
            handleScroll: {
                vertTouchDrag: false,
            },
            handleScale: {
                mouseWheel: false,
            },
        });

        // 自定义滚轮缩放：以鼠标位置为中心
        container.addEventListener('wheel', (e) => {
            e.preventDefault();

            const timeScale = chart.timeScale();
            const visibleRange = timeScale.getVisibleLogicalRange();
            if (!visibleRange) return;

            const containerRect = container.getBoundingClientRect();
            const mouseX = e.clientX - containerRect.left;
            const chartWidth = containerRect.width;

            const mouseRatio = mouseX / chartWidth;
            const rangeLength = visibleRange.to - visibleRange.from;
            const zoomFactor = e.deltaY > 0 ? 1.1 : 0.9;
            const newRangeLength = rangeLength * zoomFactor;

            if (newRangeLength < 10 || newRangeLength > candlestickData.length) return;

            const mouseLogicalPos = visibleRange.from + rangeLength * mouseRatio;
            const newFrom = mouseLogicalPos - newRangeLength * mouseRatio;
            const newTo = mouseLogicalPos + newRangeLength * (1 - mouseRatio);

            timeScale.setVisibleLogicalRange({
                from: newFrom,
                to: newTo,
            });
        }, { passive: false });

        // --------------------------------------------------------
        // Shift + 拖动: 垂直平移
        // --------------------------------------------------------
        let isDragging = false;
        let lastY = 0;
        let currentTopMargin = 0.1;
        let currentBottomMargin = 0.1;

        container.addEventListener('mousedown', (e) => {
            if (e.shiftKey) {
                isDragging = true;
                lastY = e.clientY;
                e.preventDefault();
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            const deltaY = e.clientY - lastY;
            lastY = e.clientY;

            const marginDelta = deltaY / container.clientHeight * 0.5;
            currentTopMargin = Math.max(0, Math.min(0.9, currentTopMargin + marginDelta));
            currentBottomMargin = Math.max(0, Math.min(0.9, currentBottomMargin - marginDelta));

            chart.priceScale('right').applyOptions({
                scaleMargins: {
                    top: currentTopMargin,
                    bottom: currentBottomMargin,
                },
            });
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        // 双击重置视图
        container.addEventListener('dblclick', () => {
            currentTopMargin = 0.1;
            currentBottomMargin = 0.1;
            chart.priceScale('right').applyOptions({
                scaleMargins: {
                    top: 0.1,
                    bottom: 0.1,
                },
            });
            chart.timeScale().fitContent();
        });
        // --------------------------------------------------------

        // 收盘价线系列
        const candlestickSeries = chart.addLineSeries({
            color: '#2962FF',
            lineWidth: 2,
            crosshairMarkerVisible: true,
            lastValueVisible: true,
            priceLineVisible: true,
        });
        candlestickSeries.setData(candlestickData);

        // 设置标记 (分型点) - 当前已禁用
        // if (markersData.length > 0) {
        //     candlestickSeries.setMarkers(markersData);
        // }

        // 笔连线 (已禁用)
        // if (strokesData.length > 0) {
        //     const strokeSeries = chart.addLineSeries({
        //         color: '#9c27b0',
        //         lineWidth: 2,
        //         crosshairMarkerVisible: false,
        //         lastValueVisible: false,
        //         priceLineVisible: false,
        //     });
        //     strokeSeries.setData(strokesData);
        // }

        // 技术指标线
        const legendContainer = document.getElementById('legend');
        indicators.forEach((indicator, index) => {
            const lineSeries = chart.addLineSeries({
                color: indicator.color,
                lineWidth: indicator.lineWidth,
                crosshairMarkerVisible: true,
                lastValueVisible: false,
                priceLineVisible: false,
            });
            lineSeries.setData(indicator.data);

            const legendItem = document.createElement('div');
            legendItem.className = 'legend-item';
            legendItem.innerHTML = `
                <div class="legend-color" style="background: ${indicator.color}"></div>
                <span>${indicator.name}</span>
            `;
            legendContainer.appendChild(legendItem);
        });

        // 添加笔图例
        if (strokesData.length > 0) {
            const strokeLegend = document.createElement('div');
            strokeLegend.className = 'legend-item';
            strokeLegend.innerHTML = `
                <div class="legend-color" style="background: #9c27b0"></div>
                <span>笔</span>
            `;
            legendContainer.appendChild(strokeLegend);
        }

        // OHLC 面板
        const ohlcPanel = document.getElementById('ohlc-panel');

        chart.subscribeCrosshairMove((param) => {
            if (!param.time || !param.point) {
                ohlcPanel.innerHTML = '';
                return;
            }

            const data = param.seriesData.get(candlestickSeries);
            if (!data) {
                ohlcPanel.innerHTML = '';
                return;
            }

            const date = new Date(param.time * 1000);
            const dateStr = date.toISOString().split('T')[0];

            // 获取指标值
            let indicatorHtml = '';
            indicators.forEach((indicator) => {
                const found = indicator.data.find(d => d.time === param.time);
                if (found) {
                    indicatorHtml += `
                        <div class="ohlc-item">
                            <span class="ohlc-label">${indicator.name}:</span>
                            <span class="ohlc-value" style="color:${indicator.color}">${found.value.toFixed(pricePrecision)}</span>
                        </div>
                    `;
                }
            });

            const closePrice = data.value !== undefined ? data.value : data.close;
            ohlcPanel.innerHTML = `
                <span class="ohlc-date">${dateStr}</span>
                <div class="ohlc-item"><span class="ohlc-label">Close:</span><span class="ohlc-value">${closePrice.toFixed(pricePrecision)}</span></div>
                ${indicatorHtml}
            `;
        });

        // 自适应大小
        const resizeObserver = new ResizeObserver(entries => {
            for (const entry of entries) {
                chart.applyOptions({
                    width: entry.contentRect.width,
                    height: entry.contentRect.height,
                });
            }
        });
        resizeObserver.observe(container);

        // 初始显示最后 120 根 K 线
        if (candlestickData.length > 120) {
            const from = candlestickData[candlestickData.length - 120].time;
            const to = candlestickData[candlestickData.length - 1].time;
            chart.timeScale().setVisibleRange({ from, to });
        }

        // --------------------------------------------------------
        // 方向键导航 (带高亮标记)
        // --------------------------------------------------------
        let currentDataIndex = -1;
        let isKeyNavMode = false;  // 是否处于键盘导航模式

        // 鼠标移动时同步索引（但不覆盖标记）
        chart.subscribeCrosshairMove((param) => {
            if (param.time && !isKeyNavMode) {
                const idx = candlestickData.findIndex(d => d.time === param.time);
                if (idx !== -1) {
                    currentDataIndex = idx;
                }
            }
        });

        // 鼠标点击时退出键盘导航模式，清除标记
        container.addEventListener('click', () => {
            if (isKeyNavMode) {
                isKeyNavMode = false;
                candlestickSeries.setMarkers([]);  // 清除高亮标记
            }
        });

        function moveToCandleIndex(index) {
            if (index < 0 || index >= candlestickData.length) return;

            isKeyNavMode = true;
            currentDataIndex = index;
            const dataPoint = candlestickData[index];

            // 确保 K 线在可见区域内，如果不在则滚动到居中位置
            const visibleRange = chart.timeScale().getVisibleLogicalRange();
            if (visibleRange) {
                // 检查当前 K 线是否在可视范围外
                if (index < visibleRange.from + 5 || index > visibleRange.to - 5) {
                    const rangeLength = visibleRange.to - visibleRange.from;
                    const newFrom = index - rangeLength / 2;
                    const newTo = index + rangeLength / 2;
                    chart.timeScale().setVisibleLogicalRange({ from: newFrom, to: newTo });
                }
            }

            // 设置高亮标记（黄色圆点）
            candlestickSeries.setMarkers([{
                time: dataPoint.time,
                position: 'inBar',
                color: '#FFEB3B',
                shape: 'circle',
                size: 1.5,
            }]);

            const date = new Date(dataPoint.time * 1000);
            const dateStr = date.toISOString().split('T')[0];
            const closePrice = dataPoint.value !== undefined ? dataPoint.value : dataPoint.close;

            let indicatorHtml = '';
            indicators.forEach((indicator) => {
                const found = indicator.data.find(d => d.time === dataPoint.time);
                if (found) {
                    indicatorHtml += `
                        <div class="ohlc-item">
                            <span class="ohlc-label">${indicator.name}:</span>
                            <span class="ohlc-value" style="color:${indicator.color}">${found.value.toFixed(pricePrecision)}</span>
                        </div>
                    `;
                }
            });

            ohlcPanel.innerHTML = `
                <span class="ohlc-date">${dateStr}</span>
                <div class="ohlc-item"><span class="ohlc-label">Close:</span><span class="ohlc-value">${closePrice.toFixed(pricePrecision)}</span></div>
                <span style="color:#FFEB3B; font-size:11px;">●</span>
                ${indicatorHtml}
            `;
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                if (currentDataIndex === -1) {
                    currentDataIndex = candlestickData.length - 1;
                } else if (currentDataIndex > 0) {
                    currentDataIndex--;
                }
                moveToCandleIndex(currentDataIndex);
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                if (currentDataIndex === -1) {
                    currentDataIndex = 0;
                } else if (currentDataIndex < candlestickData.length - 1) {
                    currentDataIndex++;
                }
                moveToCandleIndex(currentDataIndex);
            } else if (e.key === 'Escape') {
                // ESC 退出键盘导航模式
                isKeyNavMode = false;
                candlestickSeries.setMarkers([]);
            }
        });
    </script>
</body>

</html>